# Building from Source

Build Mystral Native.js from source for custom configurations or development.

## Prerequisites

- **CMake 3.20+**
- **C++17 compiler** (Clang, GCC, or MSVC)
- **Bun** (for downloading dependencies)

### macOS

```bash
# Install Xcode command line tools
xcode-select --install

# Install CMake via Homebrew
brew install cmake
```

### Windows

```bash
# Install Visual Studio 2022 with C++ workload
# Install CMake from cmake.org or via winget:
winget install Kitware.CMake
```

### Linux

```bash
# Ubuntu/Debian
sudo apt install build-essential cmake libx11-dev libxrandr-dev libxcursor-dev

# Fedora
sudo dnf install gcc-c++ cmake libX11-devel libXrandr-devel libXcursor-devel
```

## Basic Build

```bash
# Clone the repository
git clone https://github.com/mystralengine/mystralnative.git
cd mystralnative

# Install bun and dependencies
curl -fsSL https://bun.sh/install | bash
bun install

# Download prebuilt dependencies
bun run deps:download

# Configure and build
bun run configure
bun run build

# Verify
./build/mystral --version
```

## Build Options

### JavaScript Engine

Choose your JavaScript engine:

```bash
# V8 (recommended) - full ES2024+, JIT compilation, Chrome-compatible
cmake -B build -DMYSTRAL_USE_V8=ON -DMYSTRAL_USE_QUICKJS=OFF

# QuickJS - smallest binary, no JIT, good for CI
cmake -B build -DMYSTRAL_USE_QUICKJS=ON

# JavaScriptCore - macOS/iOS system engine, smallest macOS binary
cmake -B build -DMYSTRAL_USE_JSC=ON -DMYSTRAL_USE_QUICKJS=OFF
```

### WebGPU Backend

Choose your WebGPU implementation:

```bash
# Dawn (recommended) - Chrome's implementation, best shader compatibility
cmake -B build -DMYSTRAL_USE_DAWN=ON -DMYSTRAL_USE_WGPU=OFF

# wgpu-native - Rust implementation, best iOS/Android support
cmake -B build -DMYSTRAL_USE_WGPU=ON
```

### Combined Example

```bash
# V8 + Dawn (recommended for desktop development)
cmake -B build \
    -DMYSTRAL_USE_V8=ON \
    -DMYSTRAL_USE_DAWN=ON \
    -DMYSTRAL_USE_QUICKJS=OFF \
    -DMYSTRAL_USE_WGPU=OFF \
    -DCMAKE_BUILD_TYPE=Release

cmake --build build --config Release
```

## Build Types

```bash
# Debug - with debug symbols
cmake -B build -DCMAKE_BUILD_TYPE=Debug

# Release - optimized
cmake -B build -DCMAKE_BUILD_TYPE=Release

# RelWithDebInfo - optimized with debug symbols
cmake -B build -DCMAKE_BUILD_TYPE=RelWithDebInfo
```

## Platform-Specific Notes

### macOS Universal Binary

Build for both arm64 and x64:

```bash
cmake -B build -DCMAKE_OSX_ARCHITECTURES="arm64;x86_64"
cmake --build build
```

### Windows with MSVC

```powershell
cmake -B build -G "Visual Studio 17 2022"
cmake --build build --config Release
```

### Linux with Ninja

```bash
cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release
cmake --build build
```

## Downloading Dependencies

Dependencies are managed as prebuilt binaries. To download specific ones:

```bash
# Download all dependencies
bun run deps:download

# Download specific dependency
node scripts/download-deps.mjs --only v8
node scripts/download-deps.mjs --only dawn
node scripts/download-deps.mjs --only skia
```

## Troubleshooting

### CMake can't find dependencies

Ensure you've run `bun run deps:download` first. Dependencies are placed in `third_party/`.

### Linking errors on Windows

Make sure all libraries use the same CRT (static or dynamic):

```powershell
cmake -B build -DCMAKE_MSVC_RUNTIME_LIBRARY=MultiThreaded
```

### V8 build issues

V8 prebuilts require specific compiler versions. If you encounter issues, try QuickJS first.

## Next Steps

- [Configuration](/mystralnative/docs/guides/configuration) - Runtime configuration
- [Embedding](/mystralnative/docs/api/embedding) - Use as a library
