# Embedding

Use Mystral Native.js as a C++ library in your own applications.

## Overview

Mystral Native.js can be embedded in native applications to run JavaScript games within your own windowing and rendering context. This is useful for:

- iOS and Android apps with native UI
- Desktop applications with embedded game views
- Custom launchers and game platforms

## Basic Usage

```cpp
#include "mystral/runtime.h"

int main() {
    // Configure the runtime
    mystral::RuntimeConfig config;
    config.width = 1280;
    config.height = 720;
    config.title = "My Game";

    // Create the runtime
    auto runtime = mystral::Runtime::create(config);

    // Load and run a script
    runtime->loadScript("game.js");
    runtime->run();

    return 0;
}
```

## Configuration Options

```cpp
struct RuntimeConfig {
    int width = 1280;           // Window width
    int height = 720;           // Window height
    const char* title = "";     // Window title
    bool headless = false;      // Run without window
    bool enableAudio = true;    // Enable Web Audio
    bool enableGamepad = true;  // Enable Gamepad API
};
```

## Runtime API

```cpp
class Runtime {
public:
    // Create a new runtime instance
    static std::unique_ptr<Runtime> create(const RuntimeConfig& config);

    // Load a JavaScript file
    void loadScript(const std::string& path);

    // Execute JavaScript code directly
    void evaluate(const std::string& code);

    // Run the main loop (blocking)
    void run();

    // Run a single frame
    bool tick();

    // Resize the rendering surface
    void resize(int width, int height);

    // Get/set window visibility
    bool isVisible() const;
    void setVisible(bool visible);
};
```

## iOS Integration

For iOS apps, use Mystral Native.js with a Metal-backed view:

```swift
import MystralNative

class GameViewController: UIViewController {
    var runtime: MystralRuntime?

    override func viewDidLoad() {
        super.viewDidLoad()

        let config = MystralConfig()
        config.width = Int(view.bounds.width)
        config.height = Int(view.bounds.height)

        runtime = MystralRuntime(config: config, metalView: metalView)
        runtime?.loadScript("game.js")
    }

    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)
        runtime?.run()
    }
}
```

## Android Integration

For Android apps, use Mystral Native.js with a SurfaceView:

```kotlin
class GameActivity : Activity() {
    private lateinit var runtime: MystralRuntime

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        val surfaceView = SurfaceView(this)
        setContentView(surfaceView)

        surfaceView.holder.addCallback(object : SurfaceHolder.Callback {
            override fun surfaceCreated(holder: SurfaceHolder) {
                val config = MystralConfig().apply {
                    width = surfaceView.width
                    height = surfaceView.height
                }
                runtime = MystralRuntime(config, holder.surface)
                runtime.loadScript("game.js")
                runtime.run()
            }

            override fun surfaceDestroyed(holder: SurfaceHolder) {
                runtime.stop()
            }

            override fun surfaceChanged(holder: SurfaceHolder, format: Int, width: Int, height: Int) {
                runtime.resize(width, height)
            }
        })
    }
}
```

## CMake Integration

Add Mystral Native.js to your CMake project:

```cmake
# FetchContent
include(FetchContent)
FetchContent_Declare(
    mystral
    GIT_REPOSITORY https://github.com/mystralengine/mystralnative.git
    GIT_TAG v0.0.5
)
FetchContent_MakeAvailable(mystral)

# Link to your target
target_link_libraries(my_app PRIVATE mystral::runtime)
```

## Event Handling

Forward input events to the runtime:

```cpp
// Keyboard
runtime->onKeyDown(keyCode, modifiers);
runtime->onKeyUp(keyCode, modifiers);

// Mouse
runtime->onMouseMove(x, y);
runtime->onMouseDown(button, x, y);
runtime->onMouseUp(button, x, y);

// Touch (mobile)
runtime->onTouchStart(id, x, y);
runtime->onTouchMove(id, x, y);
runtime->onTouchEnd(id);
```

## Limitations

When embedding, be aware of:

- **Threading**: The runtime must be used from a single thread
- **Context**: WebGPU device and context are created internally
- **Audio**: Requires SDL3 audio backend initialization

## Next Steps

- [Building from Source](/mystralnative/docs/guides/building) - Build the library
- [Platform Guides](/mystralnative/docs/platforms/macos) - Platform-specific details
